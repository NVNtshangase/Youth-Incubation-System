{% extends "base.html" %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f0f4f8; border-radius: 10px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul class="flashes">
            {% for category, message in messages %}
                <li class="flash {{ category }}">
                    {{ message }}
                    <button class="close-btn" onclick="this.parentElement.style.display='none';">&times;</button>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
    {% endwith %}

    <!-- Profile Title -->
    <h1 style="text-align: center; color: #1f4d7a; font-weight: bold;">{{ role|capitalize }} Profile</h1>

    <!-- Profile Picture Upload -->
    <div style="text-align: center; margin-top: 20px;">
        <div class="profile-img-wrapper" style="position: relative; display: inline-block;">
            <!-- Display the profile picture -->
            <img id="profile-picture" src="{{ url_for('static', filename='images/image.png') }}" alt="Profile Picture" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #4CAF50;">
            <input type="file" id="upload-image" style="display: none;" accept="image/*">
            <button onclick="document.getElementById('upload-image').click();" style="position: absolute; bottom: 5px; right: 5px; background-color: #4CAF50; border: none; padding: 5px 10px; border-radius: 5px; color: white; cursor: pointer;">Upload</button>
        </div>
    </div>

    <!-- Profile Information -->
    {% if profile %}
        <div style="margin-top: 30px;">
            {% if role == 'student' %}
                <p style="color: #333;"><strong>Name:</strong> {{ profile.student_name }} {{ profile.student_surname }}</p>
                <p style="color: #333;"><strong>Email:</strong> {{ profile.student_email }}</p>
                <p style="color: #333;"><strong>Phone:</strong> {{ profile.student_phone_number }}</p>
            {% elif role == 'donor' %}
                <p style="color: #333;"><strong>Name:</strong> {{ profile.donor_name }} {{ profile.donor_surname }}</p>
                <p style="color: #333;"><strong>Email:</strong> {{ profile.donor_email }}</p>
                <p style="color: #333;"><strong>Phone:</strong> {{ profile.donor_phone_number }}</p>
            {% endif %}
        </div>
    {% else %}
        <p style="color: #333;">No profile information available.</p>
        <div style="margin-top: 20px; text-align: center;">
            <a href="{{ url_for('home') }}" style="text-decoration: none; color: white; background-color: #1f4d7a; padding: 10px 15px; border-radius: 5px; transition: background-color 0.3s;">Back Home</a>
        </div>
    {% endif %}

    <!-- Actions -->
    <div class="action-links" style="margin-top: 30px; display: flex; justify-content: space-between;">
        <a class="back-link" href="{{ url_for('dashboard') }}" style="text-decoration: none; color: white; background-color: #4CAF50; padding: 10px 15px; border-radius: 5px; transition: background-color 0.3s;">Back</a>

        <form action="{{ url_for('delete_account') }}" method="POST" style="display: inline;">
            <button type="submit" class="delete-link" style="color: white; background-color: #C62828; border: none; padding: 10px 15px; cursor: pointer; border-radius: 5px; transition: background-color 0.3s;">Delete Account</button>
        </form>
    </div>
</div>

<!-- JavaScript to handle local profile picture upload and persistence -->
<script>
    // Event listener to upload and preview profile picture
    document.getElementById('upload-image').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                // Store the image in localStorage
                localStorage.setItem('profile_picture', base64Image);
                // Set the uploaded image as the profile picture
                document.getElementById('profile-picture').src = base64Image;
            }
            reader.readAsDataURL(file); // Convert the image to a base64 URL for local display
        }
    });

    // Load the stored profile picture from localStorage on page load
    window.onload = function() {
        const storedImage = localStorage.getItem('profile_picture');
        if (storedImage) {
            document.getElementById('profile-picture').src = storedImage;
        }
    };
</script>
{% endblock %}
